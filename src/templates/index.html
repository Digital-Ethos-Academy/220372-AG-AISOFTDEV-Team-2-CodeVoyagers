{% extends "base.html" %}

{% block title %}AI Utils - Demo{% endblock %}

{% block content %}
<h1>AI Utils — Demo</h1>
<p>This demo tests the LLM integration similar to the notebook example you provided.</p>

<div class="card">
  <h3>Server Status</h3>
  <p id="status">Loading...</p>
  
  <h3>Test LLM</h3>
  <p><button id="testBtn" onclick="runTest()">Run LLM Test</button></p>
  
  <h3>Output</h3>
  <pre id="output">Click "Run LLM Test" to test the model connection and see the output</pre>
</div>
{% endblock %}

{% block scripts %}
<script>
  let loading = false;

  async function fetchStatus() {
    try {
      const response = await fetch('/api/status');
      const data = await response.json();
      const statusEl = document.getElementById('status');
      
      if (data.message) {
        statusEl.textContent = data.message;
      } else {
        statusEl.textContent = data.status || JSON.stringify(data);
      }
    } catch (error) {
      document.getElementById('status').textContent = '❌ Server unavailable';
    }
  }

  async function runTest() {
    if (loading) return;
    
    loading = true;
    const testBtn = document.getElementById('testBtn');
    const outputEl = document.getElementById('output');
    
    testBtn.textContent = 'Running...';
    testBtn.disabled = true;
    outputEl.textContent = '';
    
    try {
      const response = await fetch('/api/completion', { method: 'POST' });
      const data = await response.json();
      outputEl.textContent = data.output || JSON.stringify(data);
    } catch (error) {
      outputEl.textContent = String(error);
    } finally {
      loading = false;
      testBtn.textContent = 'Run LLM Test';
      testBtn.disabled = false;
    }
  }

  // Load status on page load
  fetchStatus();
</script>
{% endblock %}
